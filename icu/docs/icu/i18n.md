# 软件国际化

## 软件国际化概述

开发全球化软件是一项持续的平衡行为，因为软件开发人员和项目经理往往会无意中低估创建外语版本的软件所需的工作量和细节。

软件开发人员必须理解 ICU 服务才能设计和部署成功的软件发行。这些服务可以节省 ICU 用户处理软件生命周期关键阶段通常出现的各种问题的时间。

一般来说，创建全球化软件的标准流程包括国际化——涵盖通用的编程和设计问题，和本地化——涉及针对特定市场翻译和定制产品。

软件开发人员必须理解国际化的复杂性，因为他们编写实际的底层代码。他们如何有效利用已建立的服务来实现任务目标，决定了项目的整体成功。从根本上讲，代码和功能设计会影响产品的翻译和定制方式。因此，软件开发人员需要理解关键的本地化概念。

从地理的角度来看，Locale 是一个地点。从软件的角度来看，Locale 是一个用于选择与语言和（或）地点相关的信息的标识符。ICU Locale 信息包括所讲语言的名称和标识符、排序和词语定序要求、货币使用、数字显示偏好以及文本方向（从左到右或从右到左，水平或垂直）。

::: info 译者注
**Locale** 既可以是“地区”，又可以是“区域设置”。上面这段话中用它的两个设置写出了一个双关，故此处不译。你可以在术语表中找到“区域设置”词条。
:::

通用的区域设置敏感标准包括键盘布局、默认纸张和信封尺寸、常见的打印机和显示器分辨率、字符集或编码范围以及输入法。

## ICU 服务概述

ICU 服务通过语言和子语言对支持所有主要区域设置（子语言通常对应于一个国家或地区）。思考这个问题的一种方法是使用“X 国家使用的 Y 语言”这一短语。从一个国家到另一个国家，人们说或写某种特定语言的方式可能不会发生巨大变化（例如，奥地利、德国和瑞士都使用德语）。然而，文化习俗和国家标准往往存在很大差异。

使用 ICU 服务的一个关键优势是缩短了上市时间。显示字符串的翻译被打包在单独的文本文件中进行翻译。带有翻译人员的程序员团队不再需要搜索源代码来为每个国家和语言重写软件。

## 国际化和 Unicode

Unicode 使程序能够在程序环境中使用所有文本数据的标准编码方案。只需要对输入和输出的数据进行转换。在环境中对文本的操作被简化了，因为您不需要跟踪特定文本的编码。

Unicode 支持多语言数据，因为它对世界上所有语言的字符进行编码。您不必使用它们的编码信息来标记数据片段即可启用正确的字符，并且可以在单个文本片段中混合多种语言。

使用 ICU 使您的程序国际化有这些优势：

* 它可以处理任何语言或语言组合的文本。
* 可以编写源代码，以便程序可以适用于多种地区设置。
* 允许可配置、可装插件的本地化。
* 同时支持多种地区设置。
* 可以向非技术人员提供信息访问权限，而不必向他们开放源代码。
* **相同的代码可以移植到各种平台**。 {#joke}

## 国际化软件的项目管理技巧

在管理、开发和设计成功的国际化软件时，以下两个流程至关重要：

- 分离程序的的可执行代码与 UI 元素。
- 避免做出*文化假定*。

将静态信息（例如图片、窗口布局）与程序代码分开。还要确保程序动态生成的文本（例如数字和日期）以正确的语言显示。文本必须针对目标用户群体正确地格式化。

确保以易于适应不同语言和用户社区的方式完成文本和数据类型（例如日期）的分析和操作，包括按字母顺序排序以及查找换行符位置等任务。

字符必须正确显示在屏幕上（文本的存储格式必须转换为正确的视觉图像）。它们还必须被接受为输入（从按键、语音输入或其他类型的输入转换为文本的存储格式）。这些过程对于英语来说相对容易，但对于其他语言来说却相当具有挑战性。

### 分离程序的的可执行代码与 UI 元素

良好的软件设计要求实现用户界面 (UI) 的代码与实现底层功能的代码分离。 UI 的描述也必须与实现它的代码分开。

UI 的描述包含用户看到的项目，包括各种消息、按钮和菜单命令。它还包含有关如何布局对话框以及如何使用图标、颜色或其他视觉元素的信息。例如，德语单词往往较长，因为它们包含英语在过去 800 年中已经丧失的语法后缀。下表显示了不同语言中单词长度的差异：

| 英语 | 德语 | *塞尔维亚语西里尔文字* |
| - | - | - |
| cut | ausschneiden | исеци |
| copy | kopieren | копирај |
| paste | einfügen | залепи |

UI 的描述，尤其是用户可见的文本片段，必须放在一起，并且不能嵌入到程序的可执行代码中。 ICU 为此提供了 ResourceBundle 服务。

### 避免做出文化假定

在设计和实现代码时遇到的另一个困难是使其足够灵活，以处理其他国家和文化中不同的做事方式。大多数程序员在设计程序时都会无意识地假设用户的语言和习惯。例如，在泰国，官方日历是佛历，而不是公历。

这些假设使得在不重写底层程序的情况下很难为某些用户社区翻译代码的用户界面部分。 ICU 库提供灵活的 API，可用于执行最常见和最重要的任务。它们包含预构建的支持数据，使它们能够在 75 种语言和 200 多种区域设置中正常工作，关键是了解何时、何地、为何、如何有效地使用 API。

本节的其余部分概述了一些文化假定，请参阅下面的主题。

#### 数字和日期

数字和日期以不同的语言表示。不要实现将数字转换为字符串的函数，也不要调用不会产生语言敏感结果的低级系统接口，例如 `sprintf()` 。相反，请了解如何更有效地使用 ICU 的 [格式化数字](../format/numbers/) 和 [格式化日期和时间](../format/datetime/)。

#### 消息

在将文本片段组合成完整句子时要小心（例如，当生成错误消息时）。如果消息被翻译成新语言，这些片段可能会以不同的顺序组合在一起。ICU 提供了 [格式化消息](../format/messages/) 来帮助解决这些情况。

> :point_right: **注意**：也可能存在这样的情况：当句子的其他部分也发生变化时，句子的某些部分也发生变化（名词的单复数变化是最常见的例子）。

#### 计量单位

数字表示形式可能会因计量单位和货币价值而发生变化。货币价值可能因国家或地区而异。一个很好的例子就是 1000 美元的表示。该金额可以代表美元或加元价值。美元可以显示为 USD，而加元可以显示为 CAD，具体取决于区域设置。在这种情况下，显示的数值可能会发生变化。[格式化数字](../format/numbers/) 对此提供了一些支持。

#### 字母表顺序

即使是使用相同字母表的语言也不一定具有相同的字母顺序概念，也不要假设字母顺序与字符代码位的数字顺序相同。实际上，“a”与“A”不同，“b”与“B”不同，它们都有不同的代码位。这意味着您不能使用按位的字符串比较（例如 `strcmp()` 提供的）来对用户可见列表进行排序。

并非所有语言都将相同的字符解释为等效字符。例如字符的大小写变换并不总是一对一的映射。在确定两个字符串是否相等时，重音差异、某些字符的存在或不存在、甚至拼写差异可能都是微不足道的。[词语定序](../collation/) 服务在这方面提供了重要的帮助。

#### 字符

一个字符并不一定对应后备存储中的一个码位。并非所有语言对单词的定义都相同，也可能不认为任何由空白分隔的字符组合都是对单词定义的可接受近似。ICU 提供了 [文本边界分析](../boundaryanalysis/) 服务，来帮助定位边界或计算文本单元。

在检查字符是否属于特定类别时，不要列出您感兴趣的特定字符，也不要假设它们在编码方案中以任何特定顺序出现。例如， `/A-Za-z/` 并不表示大多数欧洲语言中的所有字母，而 `/0-9/` 并不表示许多书写系统中的所有数字。当使用 `isupper()` 和 `islower()` 等字符分类函数时，也是如此。ICU 提供了大量用于测试字符属性的实用函数，例如 `u_isupper()` 和 `u_islower()` 。

#### 文本输入和布局

不要假设一段文本如何在屏幕上绘制，包括它占用多少空间、它的文本方向或者它应该从屏幕上的哪个位置开始，所有这些都根据语言而变化。因此，字符和按键之间可能不存在一对一的关系，而一对多、多对一和多对多关系都发生在某些语言的真实文本中。

#### 文本处理

不要假设程序存储和操作的所有文本数据都采用任何特定语言或书写系统。ICU 提供了许多有助于文本存储的方法。为基于 Unicode 的字符操作提供了 `UnicodeString` 类和 `u_strxxx` 系列函数。例如，当追加现有的 Unicode 字符缓冲区时，可以从缓冲区中删除或提取字符。

文本操作的一个很好的例子是罗塞塔石碑，上面用象形文字、希腊语和通俗文字写有相同的文字。ICU 提供正确处理此类多语言文本的服务。

#### 日期时间格式化

时间可以用许多单位来确定，例如月或年的长度、哪天是一周的第一天，或者允许的值的范围，例如月和年（使用 `DateFormat` ）。它还可以确定您所在的时区（使用 `TimeZone` ）或夏令时开始的时间。ICU 提供处理这些问题所需的日历服务。

#### 分布式区域设置支持

在大多数服务器应用程序中，不要假设连接到服务器的所有客户端都使用相同的语言与其用户进行交互，也不要假设只要讲一种语言的用户替换了讲另一种语言的另一个用户，会话就会停止并重新启动。ICU 为程序提供了足够的灵活性，可以同时处理多个区域设置。例如，Web 服务器需要同时向不同的用户、语言和日期格式提供页面。

#### LayoutEngine

ICU LayoutEngine 是一个开源库，它提供了一个统一、易于使用的界面，用于准备复杂的 *字母* 或文本以进行显示。*拉丁字母* 是软件开发人员中最常用的字母，也是最不复杂的显示字母，尤其是在用于英语文本时。使用拉丁字母，字符可以按照它们在内存中存储的顺序从左到右显示。有些字母需要比拉丁字母更复杂的渲染行为。我们将这些字母称为“复杂字母”，并将用这些字母编写的文本称为“复杂字母”。
